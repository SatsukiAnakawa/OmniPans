# 変更履歴

このプロジェクトの全ての変更点は、このファイルに記録されます。

## [1.2.0] - 2025-06-19

### 追加 (Added)
- スライダーのラベル（「音量」「パン」）を、状態に応じて動的に変化するアイコンに変更し、視認性と操作性を向上。
- スピーカーアイコンのクリックによるミュート切り替え機能。
- パンアイコンのクリックによるパンのリセット（中央揃え）/復元機能。
- パンのリセット状態をアプリ終了後も記憶し、永続化する機能。
- デバイス数が画面の高さを超えた場合に、フライアウトウィンドウにスクロールバーを表示する機能。
- 非表示デバイスのメニューで、デバイスを再表示してもメニューが閉じないようにし、連続操作を可能に。

### 変更 (Changed)
- Serilogのログ出力設定を、`appsettings.json`からコード定義に一本化。
- P/Invoke呼び出しを、32ビット/64ビット両環境に対応する堅牢な実装に統一。
- `UserDevicePreferencesService`の設計を改善し、コンストラクタからファイルI/O処理を分離することで、テスト容易性と疎結合性を向上。
- XAML内のマジックストリングを`x:Static`を用いた定数参照に置き換え、コードのタイプセーフ性と保守性を向上。

### 修正 (Fixed)
- コード全体の品質と保守性を向上させるため、大規模なリファクタリングを実施。
  - **MVVM責務分離の強化:** ViewModelからUI固有の表示ロジックをコンバーターへ分離し、テスト容易性を向上。
  - **疎結合性の向上:** `IMessenger`をDI経由で注入するように変更し、コンポーネントの独立性を確保。
  - **エラーハンドリングの堅牢化:** `PanChangeNotifier`に例外処理を追加し、競合状態によるアプリケーションのクラッシュを防止。
  - **可読性の向上:** マジックナンバーやマジックストリングを定数クラスに置き換え、コードの意図を明確化。
- `DeviceViewModel`のコンストラクタの引数が不足していた問題を修正。
- パンのリセット機能が、OSの実際のパン設定に即時反映されない問題を修正。
- `DeviceViewModel`のパンリセット処理を非同期化し、UIスレッドのブロッキングを解消して応答性を向上。
- パンのリセット機能に詳細な例外ログ処理を追加し、エラー発生時の追跡可能性と堅牢性を強化。
- スライダーの手動操作でパンを0にした際に、意図せずリセット前の値に復元されてしまう問題を修正。
- アプリ実行中のオーディオデバイスの有効化/無効化時に、タスクトレイアイコンが応答しなくなることがある安定性の問題を修正。
- オーディオデバイスの追加・削除時における`FlyoutViewModel`の更新ロジックを最適化。ViewModelの不要な再生成を抑制することで、UIの応答性と安定性を向上。
- コンテキストメニューの項目で、マウスカーソルを余白に合わせた際に文字だけが取り残されたように見える表示の不具合を修正。
- コンテキストメニューの項目で、アイコンがない場合に不要な左側の余白が表示される問題を修正。

### 削除 (Removed)
- 不要となった`<UseWindowsForms>`設定、冗長な`OnPropertyChanged`オーバーライド、および`AssemblyInfo.cs`ファイルを削除し、プロジェクトをクリーンアップ。


## [1.1.0] - 2025-06-16

### 修正 (Fixed)
- 単一ファイル形式で発行した際に、ログ機能が原因でアプリが起動に失敗する重大な不具合を修正。

### 追加 (Added)
- アプリケーションの多重起動を防止する機能を追加。

### 変更 (Changed)
- リリースビルドの配布形式を「自己完結」から「フレームワーク依存」に変更し、ファイルサイズを大幅に削減（約180MB → 約20MB）。
- 不要な`Newtonsoft.Json`へのパッケージ参照を削除し、依存関係を整理。


## [1.0.0] - 2025-06-15

### 初回リリース

OmniPansの最初の安定版リリースです。

#### 主な機能と特徴

- **集中コントロール**: 接続されている全ての音声出力デバイスの音量とパン（左右バランス）を、一つのフライアウトウィンドウで管理。
- **スタートアップ登録**: PC起動時のアプリ自動起動設定を、タスクトレイメニューから切り替え可能。
- **デバイスの非表示/再表示**: 不要なデバイスを非表示にし、メニューから簡単に再表示可能。
- **バックグラウンド動作**: フライアウト表示中もタスクマネージャー上では「バックグラウンドプロセス」として動作。
- **UI仮想化**: `VirtualizingStackPanel`の採用により、多数のデバイス接続時も高いUIパフォーマンスを維持。
- **高速操作への応答性**: スライダーの高速連続操作時に`CancellationToken`で不要な処理をキャンセルし、応答性を向上。

#### アーキテクチャと設計
- **MVVMパターン**: UI(View)とロジック(ViewModel)を厳密に分離。
- **DI (依存性の注入)**: `Microsoft.Extensions.DependencyInjection`を利用し、クラス間の結合度を低減。
- **責務分離 (SRP)**: `DeviceFilter`, `PanChangeNotifier`, `WindowPositioner`等の専門家クラスを導入し、各クラスの責務を明確化。
- **依存関係逆転の原則 (DIP)**: `IDisplayedDevice`インターフェースの導入により、UI層が具体的な音声ライブラリの実装から独立。
- **WPFネイティブ実装**: `Hardcodet.NotifyIcon.Wpf`ライブラリの導入と`Popup`コントロールの採用により、Windows Formsへの依存を排除。
- **モダンC#**: C# 12の`プライマリコンストラクタ`や`コレクション式`を積極的に活用し、コードを簡潔化。
